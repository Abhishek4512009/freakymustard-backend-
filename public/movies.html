<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freakymustard Movies</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* --- CORE THEME --- */
        :root {
            --primary: #1db954; /* Green Theme as requested */
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #b3b3b3;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            margin: 0;
            padding-bottom: 80px; /* Space for mobile nav */
        }

        /* --- HERO START --- */
        .hero {
            padding: 40px 20px 20px;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, var(--bg) 100%);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #1db954, #1ed760);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin: 0;
        }

        .category-tabs {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding-bottom: 10px;
            scrollbar-width: none;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-main);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            flex-shrink: 0;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: #000;
            font-weight: 600;
            border-color: var(--primary);
        }

        /* --- GRID --- */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            margin-top: 20px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .back-btn {
            display: none; /* Hidden by default */
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            align-items: center;
            gap: 5px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .movie-card {
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
            aspect-ratio: 2/3;
        }

        .movie-card:hover {
            transform: scale(1.03);
            z-index: 10;
        }

        .movie-thumb {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .movie-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            padding: 40px 10px 10px;
            display: flex;
            align-items: flex-end;
        }

        .movie-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #fff;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        .folder-icon {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2a2a2a;
            color: #555;
            font-size: 3rem;
        }

        /* --- MOBILE NAV --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: #000;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid #222;
            z-index: 100;
        }

        .nav-item {
            color: #777;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            gap: 4px;
        }

        .nav-item.active {
            color: #fff;
        }

        .nav-item i {
            font-size: 1.4rem;
        }

        /* --- RESPONSIVE --- */
        @media (min-width: 768px) {
            .content-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            }
            .bottom-nav {
                display: none;
            }
        }
    </style>
</head>

<body>

    <!-- HERO SECTION -->
    <div class="hero">
        <h1 class="app-title">Freakymustard</h1>
        
        <div class="category-tabs">
            <button class="tab-btn active" onclick="switchCategory('movies', this)">Movies</button>
            <button class="tab-btn" onclick="switchCategory('series', this)">Series</button>
            <button class="tab-btn" onclick="switchCategory('others', this)">Others</button>
        </div>
    </div>

    <!-- GRID SECTION -->
    <div class="section-header">
        <h2 id="sectionTitle" class="section-title">Movies</h2>
        <button id="backBtn" class="back-btn" onclick="goBack()"><i class="ph-bold ph-arrow-left"></i> Back</button>
    </div>

    <div class="content-grid" id="grid">
        <!-- JS will populate -->
    </div>

    <!-- MOBILE NAV -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <i class="ph-fill ph-music-note"></i>
            <span>Music</span>
        </a>
        <a href="movies.html" class="nav-item active">
            <i class="ph-fill ph-film-strip"></i>
            <span>Movies</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="ph-fill ph-user"></i>
            <span>Profile</span>
        </a>
    </nav>

    <script>
        const API_URL = 'https://freakymustard.onrender.com';
        let currentCategory = 'movies';
        let folderHistory = []; // Stack to track navigation

        const grid = document.getElementById('grid');
        const backBtn = document.getElementById('backBtn');

        function switchCategory(cat, btn) {
            currentCategory = cat;
            folderHistory = []; // Reset history
            
            // Update Tabs
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            updateUI();
            fetchMovies(); // Fetch root of new category
        }

        function updateUI() {
            if (folderHistory.length > 0) {
                backBtn.style.display = 'flex';
                document.getElementById('sectionTitle').innerText = "Browse Folder";
            } else {
                backBtn.style.display = 'none';
                document.getElementById('sectionTitle').innerText = currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1);
            }
        }

        async function fetchMovies(folderId = null) {
            grid.innerHTML = '<div style="color:#666;">Loading...</div>';
            try {
                let url = `${API_URL}/api/movies/list?category=${currentCategory}`;
                if (folderId) url += `&folderId=${folderId}`;

                const res = await fetch(url);
                const items = await res.json();
                renderItems(items);
            } catch (e) {
                grid.innerText = "Error loading content.";
                console.error(e);
            }
        }

        function renderItems(items) {
            grid.innerHTML = '';
            if (items.length === 0) {
                grid.innerHTML = '<div style="color:#444;">No content found here.</div>';
                return;
            }

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'movie-card';
                const isFolder = item.mimeType === 'application/vnd.google-apps.folder';

                // Thumbnail Logic
                let thumbHtml = '';
                let title = item.name;

                if (isFolder) {
                    thumbHtml = `<div class="folder-icon"><i class="ph-fill ph-folder"></i></div>`;
                } else {
                    // Use Metadata if available
                    if (item.metadata && item.metadata.poster) {
                        thumbHtml = `<img src="${item.metadata.poster}" class="movie-thumb" loading="lazy">`;
                        title = item.metadata.title || item.name;
                    } else if (item.thumbnailLink) {
                        thumbHtml = `<img src="${item.thumbnailLink.replace('=s220', '=s600')}" class="movie-thumb" loading="lazy">`;
                    } else {
                        thumbHtml = `<img src="https://placehold.co/300x450/222/555?text=No+Cover" class="movie-thumb">`;
                    }
                }

                card.innerHTML = `
                    ${thumbHtml}
                    <div class="movie-info"><div class="movie-title">${title}</div></div>
                `;

                // Interaction Logic
                card.onclick = () => {
                    if (isFolder) {
                        folderHistory.push(item.id);
                        updateUI();
                        fetchMovies(item.id);
                    } else {
                        // Save metadata for player
                        localStorage.setItem('currentVideoMeta', JSON.stringify({
                            title: title,
                            description: (item.metadata && item.metadata.description) || "No description available.",
                            poster: (item.metadata && item.metadata.poster) || ""
                        }));
                        window.location.href = `player.html?id=${item.id}`;
                    }
                };

                grid.appendChild(card);
            });
        }

        function goBack() {
            folderHistory.pop(); // Remove current folder
            const prevFolder = folderHistory.length > 0 ? folderHistory[folderHistory.length - 1] : null;
            updateUI();
            fetchMovies(prevFolder);
        }

        // Handle Mobile Nav visibility
        if (window.innerWidth <= 768) document.querySelector('.bottom-nav').style.display = 'flex';

        // Initial Load
        fetchMovies();
    </script>
</body>

</html>